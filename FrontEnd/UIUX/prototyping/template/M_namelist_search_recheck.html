<!doctype html>
<html lang="zh-Hant">
@@include('./components/head.html')

<body>
  <div class="container-fluid pl-0 pr-0">
    @@include('./components/sidebar.html', { "sidebarCollapseFirst": "namelistManage", "sidebar": "namelistRecheck" })
    <div id="main-content" class="main-content">
      @@include('./components/navbar.html', { "navbarType": "mananger" })

      <section>
        <nav class="navbar justify-content-between panel-head ">
          <span class="navbar-brand ">名單覆核</span>

          <ul class="nav float-lg-right float-sm-none nav-function-btn">
            <li>

              <div class="nav-link " href="javascript:void(0)">
                <span class="textGary">排序</span>

                <button class="btn dropdown-toggle mb-1" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  最近
                </button>
                <div class="dropdown-menu dropdown-menu-right-sorting">
                  <a class="dropdown-item " href="# ">名單狀態</a>
                  <a class="dropdown-item " href="# ">分派/建立日期</a>
                  <a class="dropdown-item " href="# ">統一編號</a>
                  <a class="dropdown-item " href="# ">戶名</a>
                  <a class="dropdown-item " href="# ">行銷單位</a>
                  <a class="dropdown-item " href="# ">行銷人員</a>
                  <a class="dropdown-item " href="# ">產品</a>
                  <a class="dropdown-item " href="# ">名單來源</a>
                  <a class="dropdown-item " href="# ">名單類型</a>
                </div>

              </div>

            </li>
            <li>|</li>
            <li>
              <button type="button" class="nav-link btn" data-toggle="modal" data-target="#toAgency">
                <i class="fa fa-ban iconspace" aria-hidden="true"></i>退回經辦
            </li>
            <li>
              <button type="button" class="nav-link btn" data-toggle="modal" data-target="#release">
                <i class="fa fa-exchange iconspace" aria-hidden="true"></i>放行
            </li>
          </ul>


        </nav>
        <div class="pills-tab-container shadow">
          <ul class="nav nav-pills tab" id="pills-tab" role="tablist">
            <li class="nav-item">
              <a id="pills-home-tab" class="nav-link active" data-toggle="tab" href="#pills-base-info" role="tab" aria-controls="pills-base-info"
                aria-selected="true">一般名單</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="pills-notice-tab" data-toggle="pill" href="#pills-notice" role="tab" aria-controls="pills-notice"
                aria-selected="false">
                總行指派案件</a>
            </li>





          </ul>

        </div>

      </section>
      <!-- Customer 表單 -->

      <div class="tab-content" id="pills-tabContent">
        <!--  一般名單 -->
        @@include('./components/namelist/search.html',{"navbarType": "manager", "shPage": "recheck"})
        <!--  總行分派 -->
        @@include('./components/namelist/search.html', {"shTemplate": "head", "navbarType": "manager", "shPage": "recheck"})
      </div>
      <!-- 顧客查詢 -->
    </div>

    <!-- 狀態說明 -->
    <div class="modal fade" id="stateInfo" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">狀態說明</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <table class="table statusInfo">
              <thead>
                <tr>
                  <th scope="col">標示</th>
                  <th scope="col">說明</th>

                </tr>
              </thead>
              <tbody>
                <tr>

                  <td>
                    <span class="light light-red">
                    </span>
                  </td>
                  <td>紅色燈號，當此燈亮起閃爍時代表該名單即將逾期，原因包含如下：(1)未分派(限主管) (2)未執行 (3)追蹤逾期 (4)到期通知</td>
                </tr>
                <tr>

                  <td>
                    <span class="light light-gary">
                    </span>
                  </td>
                  <td>灰色燈號，該名單尚未逾期</td>
                </tr>
                <tr>
                  <td>
                    <span class="iconyellow">
                      <i class="fa fa-clock-o " aria-hidden="true"></i>
                    </span>
                  </td>
                  <td>當顯示此標示時，即代表該名單待主管放行</td>

                </tr>
                <tr>
                  <td>
                    <span class="markRed">
                      <i class="fa fa-ban" aria-hidden="true"></i>
                    </span>
                  </td>
                  <td>當顯示此標示時，即代表該名單遭主管退回</td>

                </tr>
                <tr>
                  <td>

                    <i class="fa fa-clone " aria-hidden="true"></i>

                  </td>
                  <td>當顯示此標示時，即代表該名單為重複商機</td>

                </tr>
              </tbody>
            </table>
          </div>

        </div>
      </div>
    </div>
    <!-- 退回經辦 -->
    <div class="modal fade" id="toAgency" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">退回經辦</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <h5>確認退回經辦？</h5>
            <div class="form-group">
              <label>原因
                  <span class="markRed">*</span>
              </label>
              <span class="float-right ps_note">(0/300)</span>
              <textarea class="form-control inputstyletextArea" rows="5" placeholder="請輸入..."></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-gry" data-dismiss="modal" aria-label="Close">取消</button>
            <button type="button" class="btn btn-ylw " data-dismiss="modal" aria-label="Close">確認</button>
          </div>
        </div>
      </div>
    </div>

    <!-- 設定到期日 -->
    <div class="modal fade" id="todate" tabindex="-1" role="dialog" aria-labelledby="todate" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="todate">設定到期日</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">

            <div class="form-group">
              <label>日期</label>
              <input class="form-control inputstyle" type="text" name="singledate" placeholder="請選擇日期...">
            </div>
            <h6>
              <i class="fa fa-info-circle iconspace" aria-hidden="true"></i>時間到期後則自動開啟，該行銷人員可繼續接受分派</h6>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-gry" data-dismiss="modal" aria-label="Close" onclick="saveToDate = false;">取消</button>
            <button type="button" class="btn btn-ylw " data-dismiss="modal" aria-label="Close" onclick="saveToDate = true;">儲存</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  @@include('./components/footer.html')
  <script>
    var custType = 0;
    var custID = '';
    var custIDIValid = true;
    $(document).ready(function () {

      // dropdown-menu-stop 
      $(document).on('click', '.dropdown-menu-stop', function (e) {
        e.stopPropagation();
      });
      $('input[type=checkbox].form-check-input').on('change', function () {
        var id = '#' + $(this).closest('.form-check').closest(
          '.dropdown-menu.dropdown-menu-stop').closest('.dropdown')[0].id;
        var strings = [];
        $(id).find('.dropdown-menu.dropdown-menu-stop').children().each(function () {
          var checked = $(this).find('input').prop('checked')
          if (checked) {
            strings.push($(this).find('input').val())
          }
        })
        var buttonTitle = strings.length == 0 ? '請選擇' : strings.join(', ');
        $(id).find('.btn-text').text(buttonTitle)
      })

      // table-checkbox
      $('#checkAll').on('change', function () {
        $('input[type=checkbox][name=table-checkbox]').prop('checked', $(this).prop('checked'))
        $('input[type=checkbox][name=table-checkbox]').trigger('change');
      })
      $('input[type=checkbox][name=table-checkbox]').on('change', function () {
        var checkAll = true;
        $('input[type=checkbox][name=table-checkbox]').each(function () {
          var item = $(this).prop('checked')
          if (!item) {
            checkAll = false;
            return false;
          }
        })
        $('#checkAll').prop('checked', checkAll);

        var activeBtn = false;
        $('input[type=checkbox][name=table-checkbox]').each(function () {
          var item = $(this).prop('checked')
          if (item) {
            activeBtn = true;
            return false;
          }
        })
        activateTableDatabutton(activeBtn);
      })

      // 行銷人員 switch 
      $('label.switch').each(function (index, el) {
        var input = $(el).find('input');
        $(input).on('change', function (event) {
          var checked = $(this).prop('checked');
          var parentId = '#' + $(this).prop('name');
          var title = $(parentId).find('.card-title .row .col-7');
          var circle = $(parentId).find('.card-title .row .col-5 .row .col-8 .row')
          var body = $(parentId).find('.card-body');
          var maturity = $(parentId).find('.maturity');
          var tooltip = $(parentId).find('span[data-toggle=tooltip]');
          if (checked) {
            $(title).removeClass('disablecolor');
            $(body).removeClass('disablecolor');
            $(circle).removeClass('disablecolor');
            $(maturity).addClass('displayno');
            $(tooltip).tooltip('hide').attr('data-original-title', '關閉分派')
            tooltipId = '';
          } else {
            $(title).addClass('disablecolor');
            $(body).addClass('disablecolor');
            $(circle).addClass('disablecolor');
            $(maturity).removeClass('displayno');
            $(tooltip).tooltip('hide').attr('data-original-title', '開啟分派');
            $('#todate').css('z-index', 10001).modal('show');
            $('.modal-backdrop').css('z-index', 10000);
            tooltipId = parentId;
          }
        })
      });
      $('#todate').on('hidden.bs.modal', function () {
        if (saveToDate) {
          return;
        } else {
          var input = $(tooltipId).find('input[type=checkbox]');
          $(input).prop('checked', true)
          $(input).trigger('change');
        }
      })
      /**/
    });

    // function openDatePicker(id) {
    //     console.log('aaa')
    //     var did = "#" + id
    //     $(did).datepicker('show');
    // }

    function activateTableDatabutton(active) {
      $('ul.nav-function-btn li').children().each(function () {
        if ($(this).hasClass('nav-link')) {
          $(this).prop('disabled', !active)

        };
      });
    }
  </script>

  <script id="search_error" type="text/template">
    <div class="nodata">
      <div>
        <img src="../img/img_empty.png" class="d-inline-block align-top" alt="">
      </div>
      <h6>查無資料</h6>

    </div>
  </script>
</body>

</html>